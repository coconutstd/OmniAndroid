Index: app/src/main/java/com/example/omniandroid/CameraActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.omniandroid;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.app.ActivityCompat;\r\n\r\nimport android.Manifest;\r\nimport android.app.Activity;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.database.Cursor;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.BitmapFactory;\r\nimport android.net.Uri;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.os.Environment;\r\nimport android.provider.MediaStore;\r\nimport android.text.Editable;\r\nimport android.text.TextUtils;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.Toast;\r\n\r\n\r\nimport com.amazonaws.auth.AWSCredentialsProvider;\r\nimport com.amazonaws.mobile.client.AWSMobileClient;\r\nimport com.amplifyframework.AmplifyException;\r\nimport com.amplifyframework.api.aws.AWSApiPlugin;\r\nimport com.amplifyframework.api.aws.ApiAuthProviders;\r\nimport com.amplifyframework.auth.cognito.AWSCognitoAuthPlugin;\r\nimport com.amplifyframework.core.Amplify;\r\nimport com.amplifyframework.core.AmplifyConfiguration;\r\nimport com.amplifyframework.storage.options.StorageUploadFileOptions;\r\nimport com.amplifyframework.storage.s3.AWSS3StoragePlugin;\r\nimport com.example.omniandroid.fragments.MainFragment;\r\n\r\nimport java.io.BufferedWriter;\r\nimport java.io.File;\r\nimport java.io.FileWriter;\r\nimport java.io.IOException;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.Date;\r\n\r\n\r\npublic class CameraActivity extends AppCompatActivity {\r\n\r\n    private static final String TAG = \"hyeju\";\r\n    final static int PICK_FROM_ALBUM = 1; //갤러리에서 사진선택\r\n    final static int PICK_FROM_CAMERA = 2;  //카메라로찍은 사진선택\r\n    private File tempFile;\r\n    private File saveFile;\r\n    private EditText setName;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_camera);\r\n\r\n        try {\r\n            Amplify.addPlugin(new AWSCognitoAuthPlugin());\r\n            Amplify.addPlugin(new AWSS3StoragePlugin());\r\n            Amplify.configure(getApplicationContext());\r\n            Log.i(\"MyAmplifyApp\", \"Initialized Amplify\");\r\n//            Amplify.addPlugin(new AWSApiPlugin());\r\n\r\n            Log.i(\"MyAmplifyApp\", \"Add S3 Plugin\");\r\n        } catch (AmplifyException e) {\r\n            Log.e(\"MyAmplifyApp\", \"Could not initialize Amplify\", e);\r\n        }\r\n\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n            if (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED && checkSelfPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED) {\r\n                Log.d(TAG, \"권한 설정 완료\");\r\n            } else {\r\n                Log.d(TAG, \"권한 설정 요청\");\r\n                ActivityCompat.requestPermissions(CameraActivity.this, new String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE}, 1);\r\n            }\r\n        }\r\n        Button button = (Button)findViewById(R.id.btnPicture);\r\n        Button btn_ok = (Button)findViewById(R.id.btn_ok);\r\n\r\n        setName = (EditText)findViewById(R.id.setName);\r\n\r\n        //(보류)setName 입력값이 s3버킷에 이미 존재하는 객체 이름이랑 같은 게 존재하면 이미 존재 팝업\r\n\r\n        //갤러리 버튼\r\n        button.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                if(TextUtils.isEmpty(setName.getText()))\r\n                    Toast.makeText(getApplicationContext(), \"이름을 먼저 입력해주세요!!\", Toast.LENGTH_LONG).show();\r\n                else\r\n                    goToAlbum();\r\n            }\r\n        });\r\n\r\n        //완료 버튼\r\n        btn_ok.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(getApplicationContext(), MainActivity.class);\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    @Override\r\n    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n        String name = setName.getText().toString();\r\n\r\n        if (resultCode != Activity.RESULT_OK) {\r\n            Toast.makeText(this, \"취소 되었습니다.\", Toast.LENGTH_SHORT).show();\r\n            if (tempFile != null) {\r\n                if (tempFile.exists()) {\r\n                    if (tempFile.delete()) {\r\n                        Log.e(TAG, tempFile.getAbsolutePath() + \" 삭제 성공\");\r\n                        tempFile = null;\r\n                    }\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        if (requestCode == PICK_FROM_ALBUM) {\r\n            Uri photoUri = data.getData();\r\n            String imagePath = getRealPathFromURI(photoUri);\r\n\r\n            Log.d(TAG, \"PICK_FROM_ALBUM photoUri : \" + photoUri);\r\n\r\n            saveFile = new File(imagePath);\r\n            uploadFile(saveFile, name);\r\n            setImage();\r\n        }\r\n    }\r\n\r\n    private void goToAlbum() {\r\n        Intent intent = new Intent(Intent.ACTION_PICK);\r\n        intent.setType(MediaStore.Images.Media.CONTENT_TYPE);\r\n        startActivityForResult(intent, PICK_FROM_ALBUM);\r\n    }\r\n\r\n    private void setImage() {\r\n\r\n        ImageView imageView = findViewById(R.id.result);\r\n\r\n        BitmapFactory.Options options = new BitmapFactory.Options();\r\n        Bitmap originalBm = BitmapFactory.decodeFile(saveFile.getAbsolutePath(), options);\r\n\r\n        Log.d(TAG, \"setImage : \" + saveFile.getAbsolutePath());\r\n\r\n//        imageView.getLayoutParams().height = 100;\r\n//        imageView.getLayoutParams().width = 100;\r\n//        imageView.requestLayout();\r\n\r\n        imageView.setImageBitmap(originalBm);\r\n\r\n        tempFile = null;\r\n    }\r\n\r\n    private void uploadFile(File exampleFile, String name) {\r\n        Log.d(\"s3upload\", exampleFile.toString());\r\n        Amplify.Storage.uploadFile(\r\n                name + \".jpg\",\r\n                exampleFile,\r\n                result -> Log.i(\"MyAmplifyApp\", \"Successfully uploaded: \" + result.getKey()),\r\n                storageFailure -> Log.e(\"MyAmplifyApp\", \"Upload failed\", storageFailure)\r\n        );\r\n    }\r\n\r\n    // 경로 변환\r\n    private String getRealPathFromURI(Uri contentUri) {\r\n        int column_index=0;\r\n        String[] proj = {MediaStore.Images.Media.DATA};\r\n        Cursor cursor = getContentResolver().query(contentUri, proj, null, null, null);\r\n        if(cursor.moveToFirst()){\r\n            column_index = cursor.getColumnIndexOrThrow(MediaStore.Images.Media.DATA);\r\n        }\r\n\r\n        return cursor.getString(column_index);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/omniandroid/CameraActivity.java	(revision 516df9163085766b825cdd6c5b0c29bd8352a958)
+++ app/src/main/java/com/example/omniandroid/CameraActivity.java	(date 1608196262654)
@@ -61,9 +61,10 @@
         setContentView(R.layout.activity_camera);
 
         try {
+            Amplify.configure(getApplicationContext());
             Amplify.addPlugin(new AWSCognitoAuthPlugin());
             Amplify.addPlugin(new AWSS3StoragePlugin());
-            Amplify.configure(getApplicationContext());
+
             Log.i("MyAmplifyApp", "Initialized Amplify");
 //            Amplify.addPlugin(new AWSApiPlugin());
 
